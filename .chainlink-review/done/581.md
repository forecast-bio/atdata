# Issue #581: Refactor Index to uniform Repository model

**Priority:** medium
**Parent:** #575
**Status:** open -> CLOSED
**Created:** 2026-02-03

## History

Sub-issue of #575. Requested refactoring the `Index` class to use a uniform `Repository` pattern that pairs an `IndexProvider` with an optional `AbstractDataStore`.

## Current State Assessment

The refactoring is complete. `src/atdata/repository.py` contains:

- **`Repository` dataclass**: Pairs `IndexProvider` with optional `AbstractDataStore`. Has docstring with examples.
- **`create_repository()` factory**: Convenience function that accepts provider name ("sqlite", "redis", "postgres") and optional parameters, returning a ready-to-use `Repository`.
- **`_AtmosphereBackend` class**: Internal adapter wrapping `Atmosphere` for unified `Index` routing. Handles dataset/schema CRUD operations via ATProto publishers/loaders.

The `Index` class in `index/_index.py` uses these components internally for routing operations to the correct backend.

## Decision

**CLOSE** -- Repository pattern is fully implemented with factory function and atmosphere adapter.
