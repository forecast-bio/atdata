---
title: "atdata"
subtitle: "A loose federation of distributed, typed datasets built on WebDataset"
---

::: {.hero}
[Get Started](tutorials/quickstart.qmd){.btn .btn-primary .btn-lg}
[Examples](examples/index.qmd){.btn .btn-outline-secondary .btn-lg}
[Benchmarks](benchmarks/index.html){.btn .btn-outline-secondary .btn-lg}
[GitHub](https://github.com/forecast-bio/atdata){.btn .btn-outline-secondary .btn-lg}
:::

## What is atdata?

atdata is a Python library for **typed, serializable datasets** that flow seamlessly from local development to managed storage to federated sharing---all with the same sample types and consistent APIs.

::: {.feature-cards}

::: {.feature-card}
### Typed Samples
Define dataclass-based sample types with `@packable`. Automatic msgpack serialization and NDArray handling.
:::

::: {.feature-card}
### One-Call Writes
`write_samples()` handles sharding, key generation, and optional manifest sidecar files.
:::

::: {.feature-card}
### Batch Aggregation
NDArray fields are stacked automatically. Scalar fields become lists. No manual collation code.
:::

::: {.feature-card}
### Lens Transformations
View datasets through different schemas without duplicating data. Bidirectional with putters.
:::

::: {.feature-card}
### Managed Storage
`Index` with pluggable providers (SQLite, Redis, PostgreSQL) and data stores (local disk, S3). Schema auto-resolution on load.
:::

::: {.feature-card}
### ATProto Federation
Publish datasets to the decentralized AT Protocol network. Cross-organization discovery via your Bluesky identity.
:::

:::

## Quick Example

```{python}
#| eval: false
import numpy as np
from numpy.typing import NDArray
import atdata

@atdata.packable
class ImageSample:
    image: NDArray
    label: str
    confidence: float

# Write sharded tar files (returns a typed Dataset)
samples = [ImageSample(image=np.random.rand(224, 224, 3).astype(np.float32),
                        label="cat", confidence=0.95) for _ in range(100)]
ds = atdata.write_samples(samples, "data.tar", maxcount=50)

# Iterate with automatic batching
for batch in ds.shuffled(batch_size=32):
    images = batch.image          # (32, 224, 224, 3) numpy array
    labels = batch.label          # list of 32 strings
    break
```

## Scaling Up

### Managed storage with Index

```{python}
#| eval: false
index = atdata.Index(data_store=atdata.LocalDiskStore())
entry = index.write(samples, name="training-v1")

# Load by name --- schema auto-resolved, no sample_type needed
ds = atdata.load_dataset("@local/training-v1", split="train")
```

### Federation with ATProto

```{python}
#| eval: false
from atdata.atmosphere import Atmosphere

client = Atmosphere.login("handle.bsky.social", "app-password")
index = atdata.Index(atmosphere=client)
uri = index.promote_entry("training-v1")
```

## The Architecture

```
┌─────────────────────────────────────────────────────────────┐
│  Federation: ATProto Atmosphere                             │
│  Decentralized discovery, cross-org sharing                 │
└─────────────────────────────────────────────────────────────┘
                              ↑ promote
┌─────────────────────────────────────────────────────────────┐
│  Managed Storage: Index + SQLite/Redis + Disk/S3            │
│  Schema registry, versioned datasets, persistent data       │
└─────────────────────────────────────────────────────────────┘
                              ↑ index.write
┌─────────────────────────────────────────────────────────────┐
│  Local Development                                          │
│  write_samples(), typed iteration, lenses                   │
└─────────────────────────────────────────────────────────────┘
```

## Installation

::: {.install-box}
```bash
pip install atdata

# With ATProto support
pip install atdata[atmosphere]
```
:::

## Next Steps

- **[Quick Start](tutorials/quickstart.qmd)** --- Define samples, write datasets, iterate with batching
- **[Examples](examples/index.qmd)** --- Five end-to-end worked examples
- **[Local Workflow](tutorials/local-workflow.qmd)** --- Index-managed storage for teams
- **[Atmosphere Publishing](tutorials/atmosphere.qmd)** --- Publish to the ATProto network
- **[API Reference](reference/architecture.qmd)** --- Architecture overview and API docs
- **[Benchmarks](benchmarks/index.html)** --- Performance benchmark results
