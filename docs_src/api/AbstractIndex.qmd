# AbstractIndex { #atdata.AbstractIndex }

```python
AbstractIndex()
```

Protocol for index operations â€” implemented by Index and AtmosphereIndex.

Manages dataset metadata: publishing/retrieving schemas, inserting/listing
datasets. A single index holds datasets of many sample types, tracked via
schema references.

## Examples {.doc-section .doc-section-examples}

```python
>>> def publish_and_list(index: AbstractIndex) -> None:
...     index.publish_schema(ImageSample, version="1.0.0")
...     index.insert_dataset(image_ds, name="images")
...     for entry in index.list_datasets():
...         print(f"{entry.name} -> {entry.schema_ref}")
```

## Attributes

| Name | Description |
| --- | --- |
| [data_store](#atdata.AbstractIndex.data_store) | Optional data store for reading/writing shards. |

## Methods

| Name | Description |
| --- | --- |
| [decode_schema](#atdata.AbstractIndex.decode_schema) | Reconstruct a Packable type from a stored schema. |
| [get_dataset](#atdata.AbstractIndex.get_dataset) | Get a dataset entry by name or reference. |
| [get_schema](#atdata.AbstractIndex.get_schema) | Get a schema record by reference. |
| [insert_dataset](#atdata.AbstractIndex.insert_dataset) | Register an existing dataset in the index. |
| [publish_schema](#atdata.AbstractIndex.publish_schema) | Publish a schema for a sample type. |
| [write](#atdata.AbstractIndex.write) | Write samples and create an index entry in one step. |

### decode_schema { #atdata.AbstractIndex.decode_schema }

```python
AbstractIndex.decode_schema(ref)
```

Reconstruct a Packable type from a stored schema.

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                       | Description                            |
|--------|----------------------------|----------------------------------------|
|        | [KeyError](`KeyError`)     | If schema not found.                   |
|        | [ValueError](`ValueError`) | If schema has unsupported field types. |

#### Examples {.doc-section .doc-section-examples}

```python
>>> SampleType = index.decode_schema(entry.schema_ref)
>>> ds = Dataset[SampleType](entry.data_urls[0])
```

### get_dataset { #atdata.AbstractIndex.get_dataset }

```python
AbstractIndex.get_dataset(ref)
```

Get a dataset entry by name or reference.

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                   | Description           |
|--------|------------------------|-----------------------|
|        | [KeyError](`KeyError`) | If dataset not found. |

### get_schema { #atdata.AbstractIndex.get_schema }

```python
AbstractIndex.get_schema(ref)
```

Get a schema record by reference.

#### Raises {.doc-section .doc-section-raises}

| Name   | Type                   | Description          |
|--------|------------------------|----------------------|
|        | [KeyError](`KeyError`) | If schema not found. |

### insert_dataset { #atdata.AbstractIndex.insert_dataset }

```python
AbstractIndex.insert_dataset(ds, *, name, schema_ref=None, **kwargs)
```

Register an existing dataset in the index.

#### Parameters {.doc-section .doc-section-parameters}

| Name       | Type                                          | Description                                      | Default    |
|------------|-----------------------------------------------|--------------------------------------------------|------------|
| ds         | [Dataset](`atdata.dataset.Dataset`)           | The Dataset to register.                         | _required_ |
| name       | [str](`str`)                                  | Human-readable name.                             | _required_ |
| schema_ref | [Optional](`typing.Optional`)\[[str](`str`)\] | Explicit schema ref; auto-published if ``None``. | `None`     |
| **kwargs   |                                               | Backend-specific options.                        | `{}`       |

### publish_schema { #atdata.AbstractIndex.publish_schema }

```python
AbstractIndex.publish_schema(sample_type, *, version='1.0.0', **kwargs)
```

Publish a schema for a sample type.

#### Parameters {.doc-section .doc-section-parameters}

| Name        | Type           | Description                                            | Default    |
|-------------|----------------|--------------------------------------------------------|------------|
| sample_type | [type](`type`) | A Packable type (``@packable``-decorated or subclass). | _required_ |
| version     | [str](`str`)   | Semantic version string.                               | `'1.0.0'`  |
| **kwargs    |                | Backend-specific options.                              | `{}`       |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type         | Description                                                |
|--------|--------------|------------------------------------------------------------|
|        | [str](`str`) | Schema reference string (``local://...`` or ``at://...``). |

### write { #atdata.AbstractIndex.write }

```python
AbstractIndex.write(samples, *, name, schema_ref=None, **kwargs)
```

Write samples and create an index entry in one step.

Serializes samples to WebDataset tar files, stores them via the
appropriate backend, and creates an index entry.

#### Parameters {.doc-section .doc-section-parameters}

| Name       | Type                                          | Description                                             | Default    |
|------------|-----------------------------------------------|---------------------------------------------------------|------------|
| samples    | [Iterable](`typing.Iterable`)                 | Iterable of Packable samples. Must be non-empty.        | _required_ |
| name       | [str](`str`)                                  | Dataset name, optionally prefixed with target backend.  | _required_ |
| schema_ref | [Optional](`typing.Optional`)\[[str](`str`)\] | Optional schema reference.                              | `None`     |
| **kwargs   |                                               | Backend-specific options (maxcount, description, etc.). | `{}`       |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type                                         | Description                         |
|--------|----------------------------------------------|-------------------------------------|
|        | [IndexEntry](`atdata._protocols.IndexEntry`) | IndexEntry for the created dataset. |