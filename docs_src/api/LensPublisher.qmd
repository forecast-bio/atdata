# LensPublisher { #atdata.atmosphere.LensPublisher }

```python
atmosphere.LensPublisher(client)
```

Publishes Lens transformation records to ATProto.

This class creates lens records that reference source and target schemas
and point to the transformation code in a git repository.

## Examples {.doc-section .doc-section-examples}

```python
>>> @atdata.lens
... def my_lens(source: SourceType) -> TargetType:
...     return TargetType(field=source.other_field)
>>>
>>> atmo = Atmosphere.login("handle", "password")
>>>
>>> publisher = LensPublisher(atmo)
>>> uri = publisher.publish(
...     name="my_lens",
...     source_schema_uri="at://did:plc:abc/ac.foundation.dataset.schema/source",
...     target_schema_uri="at://did:plc:abc/ac.foundation.dataset.schema/target",
...     code_repository="https://github.com/user/repo",
...     code_commit="abc123def456",
...     getter_path="mymodule.lenses:my_lens",
...     putter_path="mymodule.lenses:my_lens_putter",
... )
```

## Security Note {.doc-section .doc-section-security-note}

Lens code is stored as references to git repositories rather than
inline code. This prevents arbitrary code execution from ATProto
records. Users must manually install and trust lens implementations.

## Methods

| Name | Description |
| --- | --- |
| [publish](#atdata.atmosphere.LensPublisher.publish) | Publish a lens transformation record to ATProto. |
| [publish_from_lens](#atdata.atmosphere.LensPublisher.publish_from_lens) | Publish a lens record from an existing Lens object. |

### publish { #atdata.atmosphere.LensPublisher.publish }

```python
atmosphere.LensPublisher.publish(
    name,
    source_schema_uri,
    target_schema_uri,
    code_repository,
    code_commit,
    getter_path,
    putter_path,
    description=None,
    language=None,
    metadata=None,
    rkey=None,
)
```

Publish a lens transformation record to ATProto.

Code references are required by the ATProto lexicon. Each lens must
point to a getter and putter implementation in a git repository.

#### Parameters {.doc-section .doc-section-parameters}

| Name              | Type                                            | Description                                                             | Default    |
|-------------------|-------------------------------------------------|-------------------------------------------------------------------------|------------|
| name              | [str](`str`)                                    | Human-readable lens name.                                               | _required_ |
| source_schema_uri | [str](`str`)                                    | AT URI of the source schema.                                            | _required_ |
| target_schema_uri | [str](`str`)                                    | AT URI of the target schema.                                            | _required_ |
| code_repository   | [str](`str`)                                    | Git repository URL containing the lens code.                            | _required_ |
| code_commit       | [str](`str`)                                    | Git commit hash for reproducibility.                                    | _required_ |
| getter_path       | [str](`str`)                                    | Module path to the getter function (e.g., 'mymodule.lenses:my_getter'). | _required_ |
| putter_path       | [str](`str`)                                    | Module path to the putter function (e.g., 'mymodule.lenses:my_putter'). | _required_ |
| description       | [Optional](`typing.Optional`)\[[str](`str`)\]   | What this transformation does.                                          | `None`     |
| language          | [Optional](`typing.Optional`)\[[str](`str`)\]   | Programming language (e.g., 'python').                                  | `None`     |
| metadata          | [Optional](`typing.Optional`)\[[dict](`dict`)\] | Arbitrary metadata dictionary.                                          | `None`     |
| rkey              | [Optional](`typing.Optional`)\[[str](`str`)\]   | Optional explicit record key.                                           | `None`     |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type                                      | Description                            |
|--------|-------------------------------------------|----------------------------------------|
|        | [AtUri](`atdata.atmosphere._types.AtUri`) | The AT URI of the created lens record. |

### publish_from_lens { #atdata.atmosphere.LensPublisher.publish_from_lens }

```python
atmosphere.LensPublisher.publish_from_lens(
    lens_obj,
    *,
    name,
    source_schema_uri,
    target_schema_uri,
    code_repository,
    code_commit,
    description=None,
    language=None,
    metadata=None,
    rkey=None,
)
```

Publish a lens record from an existing Lens object.

This method extracts the getter and putter function names from
the Lens object and publishes a record referencing them.

#### Parameters {.doc-section .doc-section-parameters}

| Name              | Type                                            | Description                            | Default    |
|-------------------|-------------------------------------------------|----------------------------------------|------------|
| lens_obj          | [Lens](`atdata.lens.Lens`)                      | The Lens object to publish.            | _required_ |
| name              | [str](`str`)                                    | Human-readable lens name.              | _required_ |
| source_schema_uri | [str](`str`)                                    | AT URI of the source schema.           | _required_ |
| target_schema_uri | [str](`str`)                                    | AT URI of the target schema.           | _required_ |
| code_repository   | [str](`str`)                                    | Git repository URL.                    | _required_ |
| code_commit       | [str](`str`)                                    | Git commit hash.                       | _required_ |
| description       | [Optional](`typing.Optional`)\[[str](`str`)\]   | What this transformation does.         | `None`     |
| language          | [Optional](`typing.Optional`)\[[str](`str`)\]   | Programming language (e.g., 'python'). | `None`     |
| metadata          | [Optional](`typing.Optional`)\[[dict](`dict`)\] | Arbitrary metadata dictionary.         | `None`     |
| rkey              | [Optional](`typing.Optional`)\[[str](`str`)\]   | Optional explicit record key.          | `None`     |

#### Returns {.doc-section .doc-section-returns}

| Name   | Type                                      | Description                            |
|--------|-------------------------------------------|----------------------------------------|
|        | [AtUri](`atdata.atmosphere._types.AtUri`) | The AT URI of the created lens record. |